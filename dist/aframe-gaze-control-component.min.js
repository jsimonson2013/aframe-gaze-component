!function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e){var o=Math.PI/2;if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("gaze-control",{dependencies:["position","rotation"],schema:{enabled:{default:!0}},init:function(){this.previousPosition=new THREE.Vector3,this.deltaPosition=new THREE.Vector3,this.setupMouseControls(),this.setupHMDControls(),this.bindMethods()},update:function(){this.data.enabled&&(this.controls.update(),this.updateOrientation(),this.updatePosition())},play:function(){this.previousPosition.set(0,0,0),this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(t){this.update()},remove:function(){this.pause()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onGazeMove=this.onGazeMove.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.releaseMouse=this.releaseMouse.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new THREE.Object3D,this.yawObject=new THREE.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},setupHMDControls:function(){this.dolly=new THREE.Object3D,this.euler=new THREE.Euler,this.controls=new THREE.VRControls(this.dolly),this.zeroQuaternion=new THREE.Quaternion},addEventListeners:function(){var t=this.el.sceneEl,e=t.canvas;return e?(e.addEventListener("mousedown",this.onMouseDown,!1),e.addEventListener("mousemove",this.onMouseMove,!1),e.addEventListener("mouseup",this.releaseMouse,!1),e.addEventListener("mouseout",this.releaseMouse,!1),e.addEventListener("touchstart",this.onTouchStart),e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd),void e.addEventListener("gazemove",this.onGazeMove)):void t.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var t=document.querySelector("a-scene"),e=t&&t.canvas;e&&(e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseup",this.releaseMouse),e.removeEventListener("mouseout",this.releaseMouse),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("gazemove",this.onGazeMove))},updateOrientation:function(){var t=new THREE.Euler;return t.order="YXZ",function(){var e=this.pitchObject,o=this.yawObject,i=this.calculateHMDQuaternion();t.setFromQuaternion(i),this.el.setAttribute("rotation",{x:THREE.Math.radToDeg(t.x)+THREE.Math.radToDeg(e.rotation.x),y:THREE.Math.radToDeg(t.y)+THREE.Math.radToDeg(o.rotation.y),z:THREE.Math.radToDeg(t.z)})}}(),calculateHMDQuaternion:function(){var t=new THREE.Quaternion;return function(){var e=this.dolly;return this.zeroed||e.quaternion.equals(this.zeroQuaternion)||(this.zeroOrientation(),this.zeroed=!0),t.copy(this.zeroQuaternion).multiply(e.quaternion),t}}(),updatePosition:function(){var t=this.el,e=this.calculateDeltaPosition(),o=t.getAttribute("position");t.setAttribute("position",{x:o.x+e.x,y:o.y+e.y,z:o.z+e.z})},calculateDeltaPosition:function(){var t=this.dolly,e=this.deltaPosition,o=this.previousPosition;return e.copy(t.position),e.sub(o),o.copy(t.position),e},updateHMDQuaternion:function(){var t=new THREE.Quaternion;return function(){var e=this.dolly;return this.controls.update(),this.zeroed||e.quaternion.equals(this.zeroQuaternion)||(this.zeroOrientation(),this.zeroed=!0),t.copy(this.zeroQuaternion).multiply(e.quaternion),t}}(),zeroOrientation:function(){var t=new THREE.Euler;t.setFromQuaternion(this.dolly.quaternion.clone().inverse()),t.z=0,t.x=0,this.zeroQuaternion.setFromEuler(t)},onGazeMove:function(t){var e=window.innerWidth,i=window.innerHeight,n=i/4,s=e/6,a=25,r=this.pitchObject,u=this.yawObject;this.previousGazeEvent;if(this.data.enabled){if(t.detail.x>0&&t.detail.x<s&&t.detail.y>0&&t.detail.y<n)var h=-a,d=-a;else if(t.detail.x>s&&t.detail.x<e-s&&t.detail.y>0&&t.detail.y<n)var h=0,d=-a;else if(t.detail.x>e-s&&t.detail.x<e&&t.detail.y>0&&t.detail.y<n)var h=a,d=-a;else if(t.detail.x>0&&t.detail.x<s&&t.detail.y>n&&t.detail.y<i-n)var h=-a,d=0;else if(t.detail.x>e-s&&t.detail.x<e&&t.detail.y>n&&t.detail.y<i-n)var h=a,d=0;else if(t.detail.x>0&&t.detail.x<s&&t.detail.y>i-n&&t.detail.y<i)var h=-a,d=a;else if(t.detail.x>s&&t.detail.x<e-s&&t.detail.y>i-n&&t.detail.y<i)var h=0,d=a;else if(t.detail.x>e-s&&t.detail.x<e&&t.detail.y>i-n&&t.detail.y<i)var h=a,d=a;else var h=0,d=0;this.previousGazeEvent=t,u.rotation.y-=.002*h,r.rotation.x-=.002*d,r.rotation.x=Math.max(-o,Math.min(o,r.rotation.x))}},onMouseMove:function(t){var e=this.pitchObject,i=this.yawObject,n=this.previousMouseEvent;if(this.mouseDown&&this.data.enabled){var s=t.movementX||t.mozMovementX,a=t.movementY||t.mozMovementY;void 0!==s&&void 0!==a||(s=t.screenX-n.screenX,a=t.screenY-n.screenY),this.previousMouseEvent=t,i.rotation.y-=.002*s,e.rotation.x-=.002*a,e.rotation.x=Math.max(-o,Math.min(o,e.rotation.x))}},onMouseDown:function(t){this.mouseDown=!0,this.previousMouseEvent=t},releaseMouse:function(){this.mouseDown=!1},onTouchStart:function(t){1===t.touches.length&&(this.touchStart={x:t.touches[0].pageX,y:t.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(t){var e,o=this.yawObject;this.touchStarted&&(e=2*Math.PI*(t.touches[0].pageX-this.touchStart.x)/this.el.sceneEl.canvas.clientWidth,o.rotation.y-=.5*e,this.touchStart={x:t.touches[0].pageX,y:t.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1}})}]);